1.描述符特权级DPL、当前特权级CPL和请求特权级RPL的含义是什么？在哪些寄存器中这些字段？对应的访问条件是什么？ (challenge)写出一些简单的小程序（c or asm）来体现这些特权级的区别和联系。
 ```
  + 建议参见链接“ http://blog.csdn.net/better0332/article/details/3416749 ”对特权级的表述，并查阅指令手册。
  - 
 ```

 ```
	CPL是当前进程的权限级别(Current Privilege Level)，是当前正在执行的代码所在的段的特权级，存在于cs寄存器的低两位;RPL说明的是进程对段访问的请求权限(Request Privilege Level)，是对于段选择子而言的，每个段选择子有自己的RPL，它说明的是进程对段访问的请求权限;DPL存储在段描述符中，规定访问该段的权限级别(Descriptor Privilege Level)，每个段的DPL固定。
	CPL被存储在CS和SS的第0位和第1位上,DPL被存储在段描述符或者门描述符的DPL字段中,RPL是通过选择子的第0位和第1位表现出来的;
当进程访问一个段时，需要进程特权级检查，一般要求DPL >= max {CPL, RPL}
 ```


2.比较不同特权级的中断切换时的堆栈变化差别；(challenge)写出一些简单的小程序（c or asm）来显示出不同特权级的的中断切换的堆栈变化情况。

```
	如果一个中断产生时任务正在用户代码中执行，那么该中断会引起CPU特权级从3到0的变化，此时CPU就会运行用户态堆栈到内核态堆栈的切换操作。CPU会从当前任务的任务状态段TSS中取得新堆栈的段选择符和偏移量。因为中断服务程序在内核中，属于0级特权级代码，所以48位的内核态堆栈指针会从TSS的ss0和esp0字段中获得。在定位了新堆栈（内核态堆栈）之后，CPU就会首先把原用户态堆栈指针ss和esp压入内核态堆栈，随后把标志积存器eflags的内容和返回位置cs，eip压入内核态堆栈。

	内核的系统调用是一个软件中断，因此任务调用系统调用时就会进入内核并执行内核中的中断服务代码。此时内核代码就会使用该任务的内核态堆栈进行操作。同样，当进入内核程序时，由于特权级别发生了改变，用户态堆栈的堆栈段和堆栈指针以及eflags会被保存在任务的内核态堆栈中。而在执行iret退出内核程序返回到用户程序时，将恢复用户态的堆栈和eflags。

	如果一个任务正在内核态中运行，那么若CPU响应中断就不再需要进行堆栈切换操作。因为此时该任务运行的内核代码已经在使用内核态堆栈，并且不涉及到优先级别的变化，所以CPU仅把eflags和中断返回指针cs，eip压入当前内核态堆栈，然后执行中断服务过程。
```

WITH PRIVILEGE TRANSITION

      D  O     31            0                     31          0
      I  F    +-------+-------+<----+           +-------+-------+<----+
      R       |#######|OLD SS |     |           |#######|OLD SS |     |
      E  E    |-------+-------|   SS:ESP        |-------+-------|   SS:ESP
      C  X    |    OLD ESP    |  FROM TSS       |    OLD ESP    |  FROM TSS
      T  P    |---------------|                 |---------------|
      I  A    |  OLD EFLAGS   |                 |  OLD EFLAGS   |
      O  N    |-------+-------|                 |-------+-------|
      N  S    |#######|OLD CS |    NEW          |#######|OLD CS |
         I    |-------+-------|   SS:EIP        |-------+-------|
       | O    |    OLD EIP    |     |           |    OLD EIP    |    NEW
       | N    |---------------|<----+           |---------------|   SS:ESP
       |      |               |                 |  ERROR CODE   |     |
       !      *               *                 |---------------|<----+
              *               *                 |               |
              *               *
              WITHOUT ERROR CODE                 WITH ERROR CODE

